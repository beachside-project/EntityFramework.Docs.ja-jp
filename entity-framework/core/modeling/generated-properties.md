---
title: 生成された値-EF Core
description: Entity Framework Core を使用する場合のプロパティの値生成の構成方法
author: AndriySvyryd
ms.author: ansvyryd
ms.date: 11/06/2019
uid: core/modeling/generated-properties
ms.openlocfilehash: 7fa3eae5e2edb7b4c40ed4f99ce4a29f367e622a
ms.sourcegitcommit: 7a709ce4f77134782393aa802df5ab2718714479
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/04/2019
ms.locfileid: "74824706"
---
# <a name="generated-values"></a><span data-ttu-id="97e57-103">生成された値</span><span class="sxs-lookup"><span data-stu-id="97e57-103">Generated Values</span></span>

## <a name="value-generation-patterns"></a><span data-ttu-id="97e57-104">値生成パターン</span><span class="sxs-lookup"><span data-stu-id="97e57-104">Value Generation Patterns</span></span>

<span data-ttu-id="97e57-105">プロパティに使用できる値生成パターンには、次の3つがあります。</span><span class="sxs-lookup"><span data-stu-id="97e57-105">There are three value generation patterns that can be used for properties:</span></span>

* <span data-ttu-id="97e57-106">値の生成なし</span><span class="sxs-lookup"><span data-stu-id="97e57-106">No value generation</span></span>
* <span data-ttu-id="97e57-107">追加時に生成される値</span><span class="sxs-lookup"><span data-stu-id="97e57-107">Value generated on add</span></span>
* <span data-ttu-id="97e57-108">追加または更新時に生成される値</span><span class="sxs-lookup"><span data-stu-id="97e57-108">Value generated on add or update</span></span>

### <a name="no-value-generation"></a><span data-ttu-id="97e57-109">値の生成なし</span><span class="sxs-lookup"><span data-stu-id="97e57-109">No value generation</span></span>

<span data-ttu-id="97e57-110">値の生成は、常にデータベースに保存される有効な値を指定することを意味します。</span><span class="sxs-lookup"><span data-stu-id="97e57-110">No value generation means that you will always supply a valid value to be saved to the database.</span></span> <span data-ttu-id="97e57-111">この有効な値は、コンテキストに追加する前に、新しいエンティティに割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="97e57-111">This valid value must be assigned to new entities before they are added to the context.</span></span>

### <a name="value-generated-on-add"></a><span data-ttu-id="97e57-112">追加時に生成される値</span><span class="sxs-lookup"><span data-stu-id="97e57-112">Value generated on add</span></span>

<span data-ttu-id="97e57-113">追加時に生成される値は、新しいエンティティに対して値が生成されることを意味します。</span><span class="sxs-lookup"><span data-stu-id="97e57-113">Value generated on add means that a value is generated for new entities.</span></span>

<span data-ttu-id="97e57-114">使用するデータベースプロバイダーによっては、値が EF またはデータベースでクライアント側で生成される場合があります。</span><span class="sxs-lookup"><span data-stu-id="97e57-114">Depending on the database provider being used, values may be generated client side by EF or in the database.</span></span> <span data-ttu-id="97e57-115">値がデータベースによって生成される場合、エンティティをコンテキストに追加するときに、EF によって一時的な値が割り当てられることがあります。</span><span class="sxs-lookup"><span data-stu-id="97e57-115">If the value is generated by the database, then EF may assign a temporary value when you add the entity to the context.</span></span> <span data-ttu-id="97e57-116">この一時的な値は、`SaveChanges()`時にデータベースによって生成された値に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="97e57-116">This temporary value will then be replaced by the database generated value during `SaveChanges()`.</span></span>

<span data-ttu-id="97e57-117">プロパティに値が割り当てられているコンテキストにエンティティを追加すると、EF は新しい値を生成するのではなく、その値を挿入しようとします。</span><span class="sxs-lookup"><span data-stu-id="97e57-117">If you add an entity to the context that has a value assigned to the property, then EF will attempt to insert that value rather than generating a new one.</span></span> <span data-ttu-id="97e57-118">CLR の既定値が割り当てられていない場合、プロパティに値が割り当てられていると見なされます (`string`の場合は`null`、`int`の場合は `0`、`Guid.Empty` の場合は `Guid`など)。</span><span class="sxs-lookup"><span data-stu-id="97e57-118">A property is considered to have a value assigned if it is not assigned the CLR default value (`null` for `string`, `0` for `int`, `Guid.Empty` for `Guid`, etc.).</span></span> <span data-ttu-id="97e57-119">詳細については、「[生成されるプロパティの明示的な値](../saving/explicit-values-generated-properties.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="97e57-119">For more information, see [Explicit values for generated properties](../saving/explicit-values-generated-properties.md).</span></span>

> [!WARNING]  
> <span data-ttu-id="97e57-120">追加されたエンティティに対して値が生成される方法は、使用されているデータベースプロバイダーによって異なります。</span><span class="sxs-lookup"><span data-stu-id="97e57-120">How the value is generated for added entities will depend on the database provider being used.</span></span> <span data-ttu-id="97e57-121">データベースプロバイダーでは、一部のプロパティの種類に対して値の生成が自動的に設定される場合がありますが、その他の場合は、値の生成方法を手動で設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="97e57-121">Database providers may automatically setup value generation for some property types, but others may require you to manually setup how the value is generated.</span></span>
>
> <span data-ttu-id="97e57-122">たとえば、SQL Server を使用すると、`GUID` のプロパティ (SQL Server シーケンシャル GUID アルゴリズムを使用) に対して値が自動的に生成されます。</span><span class="sxs-lookup"><span data-stu-id="97e57-122">For example, when using SQL Server, values will be automatically generated for `GUID` properties (using the SQL Server sequential GUID algorithm).</span></span> <span data-ttu-id="97e57-123">ただし、`DateTime` プロパティが追加時に生成されるように指定した場合は、値を生成する方法を設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="97e57-123">However, if you specify that a `DateTime` property is generated on add, then you must setup a way for the values to be generated.</span></span> <span data-ttu-id="97e57-124">これを行う1つの方法として、`GETDATE()`の既定値を構成する方法があります。[既定値](relational/default-values.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="97e57-124">One way to do this, is to configure a default value of `GETDATE()`, see [Default Values](relational/default-values.md).</span></span>

### <a name="value-generated-on-add-or-update"></a><span data-ttu-id="97e57-125">追加または更新時に生成される値</span><span class="sxs-lookup"><span data-stu-id="97e57-125">Value generated on add or update</span></span>

<span data-ttu-id="97e57-126">追加または更新時に生成される値は、レコードが保存されるたびに新しい値が生成されることを意味します (insert または update)。</span><span class="sxs-lookup"><span data-stu-id="97e57-126">Value generated on add or update means that a new value is generated every time the record is saved (insert or update).</span></span>

<span data-ttu-id="97e57-127">`value generated on add`と同様に、新しく追加されたエンティティのインスタンスのプロパティの値を指定すると、生成される値ではなく、その値が挿入されます。</span><span class="sxs-lookup"><span data-stu-id="97e57-127">Like `value generated on add`, if you specify a value for the property on a newly added instance of an entity, that value will be inserted rather than a value being generated.</span></span> <span data-ttu-id="97e57-128">更新時に明示的な値を設定することもできます。</span><span class="sxs-lookup"><span data-stu-id="97e57-128">It is also possible to set an explicit value when updating.</span></span> <span data-ttu-id="97e57-129">詳細については、「[生成されるプロパティの明示的な値](../saving/explicit-values-generated-properties.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="97e57-129">For more information, see [Explicit values for generated properties](../saving/explicit-values-generated-properties.md).</span></span>

> [!WARNING]
> <span data-ttu-id="97e57-130">追加および更新されたエンティティの値がどのように生成されるかは、使用されているデータベースプロバイダーによって異なります。</span><span class="sxs-lookup"><span data-stu-id="97e57-130">How the value is generated for added and updated entities will depend on the database provider being used.</span></span> <span data-ttu-id="97e57-131">データベースプロバイダーは、プロパティの種類によっては値の生成を自動的に設定する場合がありますが、その他の場合は、値の生成方法を手動で設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="97e57-131">Database providers may automatically setup value generation for some property types, while others will require you to manually setup how the value is generated.</span></span>
>
> <span data-ttu-id="97e57-132">たとえば、`byte[]` SQL Server を使用する場合、追加または更新時に生成されるように設定され、同時実行トークンとしてマークされるプロパティは、データベースに値が生成されるように、`rowversion` データ型で設定されます。</span><span class="sxs-lookup"><span data-stu-id="97e57-132">For example, when using SQL Server, `byte[]` properties that are set as generated on add or update and marked as concurrency tokens, will be setup with the `rowversion` data type - so that values will be generated in the database.</span></span> <span data-ttu-id="97e57-133">ただし、`DateTime` プロパティが追加または更新時に生成されるように指定した場合は、値を生成する方法を設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="97e57-133">However, if you specify that a `DateTime` property is generated on add or update, then you must setup a way for the values to be generated.</span></span> <span data-ttu-id="97e57-134">これを行う1つの方法として、`GETDATE()` の既定値 ([既定値](relational/default-values.md)を参照) を構成して新しい行の値を生成する方法があります。</span><span class="sxs-lookup"><span data-stu-id="97e57-134">One way to do this, is to configure a default value of `GETDATE()` (see [Default Values](relational/default-values.md)) to generate values for new rows.</span></span> <span data-ttu-id="97e57-135">次に、データベーストリガーを使用して、更新中に値を生成することができます (次の例のトリガーなど)。</span><span class="sxs-lookup"><span data-stu-id="97e57-135">You could then use a database trigger to generate values during updates (such as the following example trigger).</span></span>
>
> [!code-sql[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAddOrUpdate.sql)]

## <a name="conventions"></a><span data-ttu-id="97e57-136">規約</span><span class="sxs-lookup"><span data-stu-id="97e57-136">Conventions</span></span>

<span data-ttu-id="97e57-137">既定では、short、int、long、または Guid 型の非複合主キーは、追加時に値を生成するように設定されます。</span><span class="sxs-lookup"><span data-stu-id="97e57-137">By default, non-composite primary keys of type short, int, long, or Guid will be setup to have values generated on add.</span></span> <span data-ttu-id="97e57-138">その他のすべてのプロパティは、値の生成なしで設定されます。</span><span class="sxs-lookup"><span data-stu-id="97e57-138">All other properties will be setup with no value generation.</span></span>

## <a name="data-annotations"></a><span data-ttu-id="97e57-139">データの注釈</span><span class="sxs-lookup"><span data-stu-id="97e57-139">Data Annotations</span></span>

### <a name="no-value-generation-data-annotations"></a><span data-ttu-id="97e57-140">値の生成なし (データ注釈)</span><span class="sxs-lookup"><span data-stu-id="97e57-140">No value generation (Data Annotations)</span></span>

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedNever.cs#Sample)]

### <a name="value-generated-on-add-data-annotations"></a><span data-ttu-id="97e57-141">加算時に生成される値 (データ注釈)</span><span class="sxs-lookup"><span data-stu-id="97e57-141">Value generated on add (Data Annotations)</span></span>

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedOnAdd.cs#Sample)]

> [!WARNING]  
> <span data-ttu-id="97e57-142">これにより、追加されたエンティティに対して値が生成されたことを EF が認識できるだけでなく、EF が実際のメカニズムを設定して値を生成することは保証されません。</span><span class="sxs-lookup"><span data-stu-id="97e57-142">This just lets EF know that values are generated for added entities, it does not guarantee that EF will setup the actual mechanism to generate values.</span></span> <span data-ttu-id="97e57-143">詳細については、「追加」セクション[で生成された値](#value-generated-on-add)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="97e57-143">See [Value generated on add](#value-generated-on-add) section for more details.</span></span>

### <a name="value-generated-on-add-or-update-data-annotations"></a><span data-ttu-id="97e57-144">追加または更新 (データ注釈) に対して生成される値</span><span class="sxs-lookup"><span data-stu-id="97e57-144">Value generated on add or update (Data Annotations)</span></span>

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedOnAddOrUpdate.cs#Sample)]

> [!WARNING]  
> <span data-ttu-id="97e57-145">これにより、追加または更新されたエンティティに対して値が生成されたことを EF が認識できるだけでなく、EF が実際のメカニズムを設定して値を生成することは保証されません。</span><span class="sxs-lookup"><span data-stu-id="97e57-145">This just lets EF know that values are generated for added or updated entities, it does not guarantee that EF will setup the actual mechanism to generate values.</span></span> <span data-ttu-id="97e57-146">詳細について[は、「追加または更新セクションで生成された値](#value-generated-on-add-or-update)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="97e57-146">See [Value generated on add or update](#value-generated-on-add-or-update) section for more details.</span></span>

## <a name="fluent-api"></a><span data-ttu-id="97e57-147">Fluent API</span><span class="sxs-lookup"><span data-stu-id="97e57-147">Fluent API</span></span>

<span data-ttu-id="97e57-148">Fluent API を使用して、特定のプロパティの値生成パターンを変更できます。</span><span class="sxs-lookup"><span data-stu-id="97e57-148">You can use the Fluent API to change the value generation pattern for a given property.</span></span>

### <a name="no-value-generation-fluent-api"></a><span data-ttu-id="97e57-149">値の生成なし (Fluent API)</span><span class="sxs-lookup"><span data-stu-id="97e57-149">No value generation (Fluent API)</span></span>

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedNever.cs#Sample)]

### <a name="value-generated-on-add-fluent-api"></a><span data-ttu-id="97e57-150">追加時に生成された値 (Fluent API)</span><span class="sxs-lookup"><span data-stu-id="97e57-150">Value generated on add (Fluent API)</span></span>

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAdd.cs#Sample)]

> [!WARNING]  
> <span data-ttu-id="97e57-151">`ValueGeneratedOnAdd()` は、追加されたエンティティに対して値が生成されることを EF が認識できるだけでなく、EF が実際のメカニズムを設定して値を生成することを保証しません。</span><span class="sxs-lookup"><span data-stu-id="97e57-151">`ValueGeneratedOnAdd()` just lets EF know that values are generated for added entities, it does not guarantee that EF will setup the actual mechanism to generate values.</span></span>  <span data-ttu-id="97e57-152">詳細については、「追加」セクション[で生成された値](#value-generated-on-add)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="97e57-152">See [Value generated on add](#value-generated-on-add) section for more details.</span></span>

### <a name="value-generated-on-add-or-update-fluent-api"></a><span data-ttu-id="97e57-153">追加または更新 (Fluent API) で生成された値</span><span class="sxs-lookup"><span data-stu-id="97e57-153">Value generated on add or update (Fluent API)</span></span>

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAddOrUpdate.cs#Sample)]

> [!WARNING]  
> <span data-ttu-id="97e57-154">これにより、追加または更新されたエンティティに対して値が生成されたことを EF が認識できるだけでなく、EF が実際のメカニズムを設定して値を生成することは保証されません。</span><span class="sxs-lookup"><span data-stu-id="97e57-154">This just lets EF know that values are generated for added or updated entities, it does not guarantee that EF will setup the actual mechanism to generate values.</span></span> <span data-ttu-id="97e57-155">詳細について[は、「追加または更新セクションで生成された値](#value-generated-on-add-or-update)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="97e57-155">See [Value generated on add or update](#value-generated-on-add-or-update) section for more details.</span></span>
